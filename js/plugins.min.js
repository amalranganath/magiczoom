(function(e){function l(t){r=e(t[0]).attr("src").split("/").reverse().slice(1).reverse().join("/");if(n.thumpPosition=="VR"||n.thumpPosition=="VRB"){e("<div id=list /><div id=preview /><div id=zoom />").appendTo(e(a));e("#list").css({width:o+2*s,"float":"left"});e("#preview").css("float","left")}else if(n.thumpPosition=="HB"){e("<div id=preview /><div id=list /><div id=zoom />").appendTo(e(a))}else if(n.thumpPosition=="HT"||n.thumpPosition=="HTB"){e("<div id=list /><div id=preview /><div id=zoom />").appendTo(e(a))}e("#preview").css("box-shadow","0 1px 2px 0 rgba(0, 0, 0, 0.3)");e("#zoom").css({position:"absolute",visibility:"hidden",overflow:"hidden","box-shadow":"0 1px 2px 0 rgba(0, 0, 0, 0.3)"});e(t).appendTo(e("#list"));if(n.thumpPosition=="VR"||n.thumpPosition=="VRB")e(t).css({display:"block",margin:"0 "+2*s+"px "+s+"px 0"});else if(n.thumpPosition=="HB")e(t).css({display:"inline",margin:s+"px "+s+"px  "+2*s+"px 0"});else if(n.thumpPosition=="HT"||n.thumpPosition=="HTB")e(t).css({display:"inline",margin:"0 "+s+"px "+s+"px 0"})}function c(){var i=r+"/"+t.previewName,o=e('<img class=preview src="'+i+'">');o.css({position:"absolute",visibility:"hidden"});o.appendTo(e("#preview"));e(o).one("load",function(){var r=this.width,i=this.height,u=e("#preview").offset().left,a=e("#preview").offset().top;t.previewImgW=r;t.previewImgH=i;e("#preview").css({width:r,height:i});if(n.thumpPosition=="VRB"||n.thumpPosition=="HTB")e("#zoom").css({width:r,height:i,left:u,top:a+i+2*s});else e("#zoom").css({width:r,height:i,left:u+r+2*s,top:a});h();o.css({display:"none",visibility:"visible"});o.fadeIn(function(){if(e(".preview").length>1){var t=e(".preview")[0];e(t).remove()}})}).each(function(){if(this.complete)e(this).load()}).error(function(){if(e(".preview").length>0){var n=e(".preview")[0];e(n).remove()}else{var r=400,s=50;e("#preview").css({width:r,height:s});t.previewImgW=r;t.previewImgH=s}p("failed to load "+i,"#c00")})}function h(){var n=r+"/"+t.zoomName,i=e('<img class ="zoom" src="'+n+'">');i.appendTo(e("#zoom"));i.css("position","absolute");p("...load zoom...");e(i).one("load",function(){e(".message").remove();t.zoomImgW=this.width;t.zoomImgH=this.height;d()}).each(function(){if(this.complete)e(this).load()}).error(function(){p("...failed to load zoom...","#c00")})}function p(n,r){r=typeof r!=="undefined"?r:"#000";var i=e("#preview");if(e(".message").length>0){e(".message").text("...failed to load zoom...")}else{e("<div class=message>"+n+"</div>").appendTo(i);e(".message").css({position:"absolute",margin:"0","text-align":"center","vertical-align":"middle"})}e(".message").css({width:t.previewImgW,"line-height":t.previewImgH+"px",color:r})}function d(){e(".preview").mousemove(function(n){var r=n.pageX-e(this).offset().left,i=n.pageY-e(this).offset().top,s=-Math.round(r*(t.zoomImgW-t.previewImgW)/t.previewImgW),o=-Math.round(i*(t.zoomImgH-t.previewImgH)/t.previewImgH);TweenLite.to(e(".zoom"),.2,{css:{left:s,top:o}})});e(".preview").mouseover(function(t){e("#zoom").css("visibility","visible")});e(".preview").mouseout(function(t){e("#zoom").css("visibility","hidden")})}var t=new Object,n=new Object,r,i=new Array,s=5,o=0,u=false,a,f;e.fn.magicZoom=function(r){var i=e.extend({activeThumb:0,thumpPosition:"VR"},r);var s=this[i.activeThumb],u=new Array,f;a=this;f=e(this).find("img");s=f[i.activeThumb];f.each(function(){u.push(this.width);e(this).css("cursor","pointer")});o=Math.max.apply(Math,u);e(f).remove();n=i;l(f);return f.each(function(){if(this===s){t.previewName=e(this).data("preview");t.zoomName=e(this).data("zoomed");e(this).addClass("active");c()}e(this).on("click",function(n){t.previewName=e(this).data("preview");t.zoomName=e(this).data("zoomed");e(".active").removeClass("active");e(this).addClass("active");e("#zoom").empty();e(".message").remove();c()})})};})(jQuery)